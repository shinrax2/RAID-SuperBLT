try to deduplicate compress.cpp/ figure out linking in util.h without all the lua.h/platform.h depencies
clean up and review